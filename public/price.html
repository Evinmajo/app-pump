<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Prices</title>
    <link rel="icon" type="image/png" href="https://toppng.com/uploads/preview/indian-oil-corporation-vector-logo-11574259324ulqkuccpqn.png">
    <script src="./style.js"></script>
    <style>
        /* Custom styles for the Inter font and overall body */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e0eafe; /* Light blue background consistent with admin.html */
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        /* Ensure input type="number" does not show spin buttons */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield; /* Firefox specific */
        }
        /* Custom message box styles */
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            text-align: center;
            font-weight: bold;
            display: none; /* Hidden by default */
        }
        .message-box.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .message-box.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .message-box button {
            margin-top: 15px;
            padding: 8px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #2563eb;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body class="antialiased">
    <div class="bg-white p-6 sm:p-8 md:p-10 rounded-xl shadow-lg w-full max-w-lg md:max-w-xl mx-auto my-auto">
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-8 text-center">Update Fuel & Oil Prices</h1>

        <!-- Message Box for notifications -->
        <div id="messageBox" class="message-box">
            <p id="messageText"></p>
            <button onclick="hideMessageBox()">OK</button>
        </div>

        <form id="priceUpdateForm" class="space-y-6">
            <div class="grid grid-cols-1 gap-6">
                <div>
                    <label for="petrolPrice" class="block text-lg font-semibold text-gray-700 mb-2 text-center">Petrol Price (₹)</label>
                    <input type="number" id="petrolPrice" name="petrolPrice"
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 shadow-sm text-gray-800 text-center"
                           placeholder="Enter petrol price" step="0.01">
                </div>
                <div>
                    <label for="dieselPrice" class="block text-lg font-semibold text-gray-700 mb-2 text-center">Diesel Price (₹)</label>
                    <input type="number" id="dieselPrice" name="dieselPrice"
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 shadow-sm text-gray-800 text-center"
                           placeholder="Enter diesel price" step="0.01">
                </div>
                <div>
                    <label for="oilPrice" class="block text-lg font-semibold text-gray-700 mb-2 text-center">Oil Price (₹)</label>
                    <input type="number" id="oilPrice" name="oilPrice"
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 shadow-sm text-gray-800 text-center"
                           placeholder="Enter oil price" step="0.01">
                </div>
                <div>
                    <label for="speedPrice" class="block text-lg font-semibold text-gray-700 mb-2">Speed Price</label>
                    <input type="number" id="speedPrice" step="0.01"
                           class="w-full p-4 border border-gray-300 rounded-lg focus:ring-blue-500 shadow-sm text-gray-800"
                           placeholder="Enter Speed Price">
                </div>
            </div>

            <div class="flex justify-center space-x-4 mt-8">
                <button type="submit"
                        class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Update Prices
                </button>
                <button type="button" onclick="window.location.href='/hbvheiwbvhebnjhfrbvhjdbhvbfxjkbkdbhadmin'"
                        class="inline-flex items-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Back to Admin
                </button>
            </div>
        </form>
    </div>

    <script>
        // --- Message Box Functions ---
        /**
         * Displays a custom message box.
         * @param {string} message - The message to display.
         * @param {string} type - The type of message ('success' or 'error').
         */
        function showMessageBox(message, type) {
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            messageText.textContent = message;
            messageBox.className = `message-box ${type}`; // Add type class for styling
            messageBox.style.display = 'block';
        }

        /**
         * Hides the custom message box.
         */
        function hideMessageBox() {
            const messageBox = document.getElementById('messageBox');
            messageBox.style.display = 'none';
        }

        /**
         * Fetches the current prices for petrol, diesel, and oil from the backend
         * and populates the form fields.
         */
        async function loadCurrentPrices() {
            try {
                const response = await fetch('/api/prices/current');
                if (response.ok) {
                    const data = await response.json();
                    if (data) {
                        document.getElementById('petrolPrice').value = data.petrolPrice ?? '';
                document.getElementById('dieselPrice').value = data.dieselPrice ?? '';
                document.getElementById('oilPrice').value = data.oilPrice ?? '';
                document.getElementById('speedPrice').value = data.speedPrice ?? ''; // Fix: Added this
                    }
                } else {
                    console.error('Failed to fetch current prices:', await response.json());
                    showMessageBox('Failed to load current prices. Please try again.', 'error');
                }
            } catch (error) {
                console.error('Error fetching current prices:', error);
                showMessageBox('An error occurred while fetching current prices.', 'error');
            }
        }

        /**
         * Handles the form submission to update the prices.
         * Sends a PUT request to the backend with the new price data.
         */
       async function updatePrices(event) {
    event.preventDefault();

    // 1. Capture all four values from the UI
    const petrolPrice = parseFloat(document.getElementById('petrolPrice').value);
    const dieselPrice = parseFloat(document.getElementById('dieselPrice').value);
    const oilPrice = parseFloat(document.getElementById('oilPrice').value);
    const speedPrice = parseFloat(document.getElementById('speedPrice').value);

    // 2. Validate all four are numbers
    if (isNaN(petrolPrice) || isNaN(dieselPrice) || isNaN(oilPrice) || isNaN(speedPrice)) {
        showMessageBox('Please enter valid numeric values for all prices.', 'error');
        return;
    }

    // 3. Construct the full data object expected by server.js
    const data = {
        petrolPrice,
        dieselPrice,
        oilPrice,
        speedPrice
    };

    try {
        const response = await fetch('/api/prices/update', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        if (response.ok) {
            showMessageBox('Prices updated successfully!', 'success');
        } else {
            const errorData = await response.json();
            showMessageBox(`Failed: ${errorData.message}`, 'error');
        }
    } catch (error) {
        showMessageBox('An error occurred while updating prices.', 'error');
    }
}

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            loadCurrentPrices(); // Load current prices when the page loads
            document.getElementById('priceUpdateForm').addEventListener('submit', updatePrices);
        });
    </script>
</body>
</html>
